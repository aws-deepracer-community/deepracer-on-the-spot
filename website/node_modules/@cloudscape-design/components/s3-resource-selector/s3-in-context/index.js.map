{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/s3-resource-selector/s3-in-context/index.tsx"],"names":[],"mappings":"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","sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport React, { useState, useEffect, useRef } from 'react';\nimport InternalBox from '../../box/internal';\nimport { InternalButton } from '../../button/internal';\nimport InternalFormField from '../../form-field/internal';\nimport { InputProps } from '../../input/interfaces';\nimport InternalSelect from '../../select/internal';\nimport InternalStatusIndicator from '../../status-indicator/internal';\nimport { NonCancelableCustomEvent } from '../../internal/events';\nimport useForwardFocus from '../../internal/hooks/forward-focus';\nimport { useVersionsFetch } from './use-versions-fetch';\nimport { S3ResourceSelectorProps } from '../interfaces';\nimport { validate, getErrorText } from './validation';\nimport styles from './styles.css.js';\nimport { SearchInput } from './search-input';\nimport LiveRegion from '../../internal/components/live-region';\nimport { useInternalI18n } from '../../i18n/context';\n\ninterface S3InContextProps {\n  i18nStrings: S3ResourceSelectorProps.I18nStrings | undefined;\n  inputPlaceholder: string | undefined;\n  resource: S3ResourceSelectorProps.Resource;\n  viewHref: string | undefined;\n  invalid: boolean | undefined;\n  inputAriaDescribedby: string | undefined;\n  selectableItemsTypes: S3ResourceSelectorProps['selectableItemsTypes'];\n  fetchVersions: S3ResourceSelectorProps['fetchVersions'];\n  onBrowse: () => void;\n  onChange: (newResource: S3ResourceSelectorProps.Resource, errorText: string | undefined) => void;\n}\n\nexport interface S3InContextRef {\n  focus(): void;\n}\n\nexport const S3InContext = React.forwardRef(\n  (\n    {\n      i18nStrings,\n      inputPlaceholder,\n      resource,\n      viewHref,\n      invalid,\n      inputAriaDescribedby,\n      selectableItemsTypes,\n      fetchVersions,\n      onChange,\n      onBrowse,\n    }: S3InContextProps,\n    ref: React.Ref<S3InContextRef>\n  ) => {\n    const i18n = useInternalI18n('s3-resource-selector');\n    const isInputBlurredRef = useRef(true);\n    const [isInputTouched, setInputTouched] = useState(false);\n    const { versions, loading, loadVersions, resetVersions } = useVersionsFetch(fetchVersions);\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    useForwardFocus(ref, inputRef);\n\n    const uri = resource.uri;\n    const supportsVersions = selectableItemsTypes && selectableItemsTypes.indexOf('versions') > -1;\n    const selectedVersion = versions.filter(version => version.value === resource.versionId)[0] || null;\n\n    function handleUriChange(event: NonCancelableCustomEvent<InputProps.ChangeDetail>) {\n      const uri = event.detail.value;\n      const errorCode = isInputTouched ? validate(uri) : undefined;\n      resetVersions();\n      onChange({ uri }, getErrorText(i18n, i18nStrings, errorCode));\n    }\n\n    function handleUriBlur() {\n      isInputBlurredRef.current = true;\n      setInputTouched(true);\n      const errorCode = validate(resource.uri);\n      onChange(resource, getErrorText(i18n, i18nStrings, errorCode));\n      if (supportsVersions) {\n        loadVersions(resource.uri);\n      }\n    }\n\n    useEffect(() => {\n      if (!isInputBlurredRef.current || !supportsVersions) {\n        return;\n      }\n      const { cancel } = loadVersions(uri) ?? {};\n      return cancel;\n    }, [uri, supportsVersions, loadVersions]);\n\n    return (\n      <div className={styles.root}>\n        <div className={styles.layout}>\n          <InternalFormField\n            className={styles['layout-uri']}\n            label={i18n('i18nStrings.inContextUriLabel', i18nStrings?.inContextUriLabel)}\n            stretch={true}\n          >\n            <SearchInput\n              ref={inputRef}\n              value={uri}\n              ariaDescribedby={inputAriaDescribedby}\n              clearAriaLabel={i18nStrings?.inContextInputClearAriaLabel}\n              placeholder={inputPlaceholder ?? i18nStrings?.inContextInputPlaceholder}\n              onChange={handleUriChange}\n              invalid={invalid}\n              onFocus={() => (isInputBlurredRef.current = false)}\n              onBlur={handleUriBlur}\n            />\n          </InternalFormField>\n          {supportsVersions && (\n            <InternalFormField\n              className={styles['layout-version']}\n              label={i18n('i18nStrings.inContextVersionSelectLabel', i18nStrings?.inContextVersionSelectLabel)}\n              stretch={true}\n            >\n              <InternalSelect\n                selectedOption={selectedVersion}\n                placeholder={i18n('i18nStrings.inContextSelectPlaceholder', i18nStrings?.inContextSelectPlaceholder)}\n                disabled={versions.length === 0}\n                options={versions}\n                onChange={event => onChange({ ...resource, versionId: event.detail.selectedOption.value }, undefined)}\n                invalid={false} // invalid state should not highlight the select, only the text input\n              />\n            </InternalFormField>\n          )}\n          <div>\n            <InternalButton\n              className={styles['view-button']}\n              disabled={!viewHref}\n              href={viewHref}\n              target=\"_blank\"\n              iconName=\"external\"\n              iconAlign=\"right\"\n              formAction=\"none\"\n              ariaLabel={i18n('i18nStrings.inContextViewButtonAriaLabel', i18nStrings?.inContextViewButtonAriaLabel)}\n            >\n              {i18n('i18nStrings.inContextViewButton', i18nStrings?.inContextViewButton)}\n            </InternalButton>\n          </div>\n          <div className={styles['layout-divider']} />\n          <div>\n            <InternalButton className={styles['browse-button']} disabled={loading} formAction=\"none\" onClick={onBrowse}>\n              {i18n('i18nStrings.inContextBrowseButton', i18nStrings?.inContextBrowseButton)}\n            </InternalButton>\n          </div>\n        </div>\n\n        <div role=\"alert\" aria-live=\"assertive\" aria-atomic=\"true\">\n          {loading && (\n            <InternalBox margin={{ top: 's' }}>\n              <InternalStatusIndicator type=\"loading\">\n                <LiveRegion visible={true}>\n                  {i18n('i18nStrings.inContextLoadingText', i18nStrings?.inContextLoadingText)}\n                </LiveRegion>\n              </InternalStatusIndicator>\n            </InternalBox>\n          )}\n        </div>\n      </div>\n    );\n  }\n);\n"]}